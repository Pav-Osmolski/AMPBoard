(()=>{"use strict";const t=new WeakSet;function e(e,n={}){const o=document.querySelector(e);if(!o)return;if(t.has(o))return;t.add(o);const a=n.items||"li",r=n.handle||null,l=n.interactiveSelector||"input, select, textarea, button, a, [contenteditable], .no-drag",i=n.allowInsideHandle||"[data-drag-allow]",s=n.allowHandleInteractive??!0;let c=null,d=!1,u={active:!1,startX:0,startY:0,id:null,started:!1,didReorder:!1};function p(t){if(!c||!t||t===c)return;const e=Array.from(o.querySelectorAll(`:scope > ${a}`)),n=e.indexOf(c),r=e.indexOf(t);n>-1&&r>-1&&n!==r&&(n<r?t.after(c):t.before(c),u.didReorder=!0)}function m(t){u.active&&t.pointerId===u.id&&(u.started&&u.didReorder&&o.dispatchEvent(new CustomEvent("sorted",{bubbles:!0})),function(){if(Array.from(o.querySelectorAll(a)).forEach(t=>{t.classList.remove("dragElem"),t.classList.remove("over"),t.draggable=!1}),c=null,d=!1,null!==u.id&&c&&c.hasPointerCapture&&c.hasPointerCapture(u.id))try{c.releasePointerCapture(u.id)}catch(t){}u={active:!1,startX:0,startY:0,id:null,started:!1,didReorder:!1}}())}o.addEventListener("pointerdown",t=>{const e=t.target.closest(a);if(!e||!o.contains(e))return;const n=!r||!!t.target.closest(r);if(r&&!n)return;if(!!t.target.closest(l)){if(!(s&&n&&t.target.closest(i)))return}if("mouse"!==t.pointerType){c=e,u.active=!0,u.id=t.pointerId,u.startX=t.clientX,u.startY=t.clientY,u.started=!1,u.didReorder=!1;try{e.setPointerCapture(t.pointerId)}catch(t){}}else e.draggable=!0},{capture:!0}),o.addEventListener("dragstart",t=>{const e=t.target.closest(a);if(e&&o.contains(e)){if(c=e,d=!0,t.dataTransfer){t.dataTransfer.effectAllowed="move";try{t.dataTransfer.setData("text/plain","")}catch(t){}}e.classList.add("dragElem")}}),o.addEventListener("dragenter",t=>{const e=t.target.closest(a);e&&o.contains(e)&&e.classList.add("over")}),o.addEventListener("dragover",t=>{c&&t.preventDefault()}),o.addEventListener("dragleave",t=>{const e=t.target.closest(a);e&&o.contains(e)&&e.classList.remove("over")}),o.addEventListener("drop",t=>{t.preventDefault();const e=t.target.closest(a);e&&c&&e!==c&&(p(e),(u.didReorder||d)&&o.dispatchEvent(new CustomEvent("sorted",{bubbles:!0})),e.classList.remove("over"))}),o.addEventListener("dragend",t=>{const e=t.target.closest(a);e&&o.contains(e)&&(e.classList.remove("dragElem"),e.draggable=!1),Array.from(o.querySelectorAll(a)).forEach(t=>t.classList.remove("over")),c=null,d=!1}),o.addEventListener("pointermove",t=>{if(!u.active||t.pointerId!==u.id||!c)return;const e=Math.abs(t.clientX-u.startX),n=Math.abs(t.clientY-u.startY);if(!u.started){if(e+n<6)return;u.started=!0,d=!0,c.classList.add("dragElem")}t.preventDefault();const r=document.elementFromPoint(t.clientX,t.clientY);if(!r)return;const l=r.closest(a);l&&o.contains(l)&&l!==c&&(Array.from(o.querySelectorAll(a)).forEach(t=>t.classList.remove("over")),l.classList.add("over"),p(l))}),o.addEventListener("pointerup",m),o.addEventListener("pointercancel",m),o.addEventListener("click",t=>{d&&r&&t.target.closest(r)&&t.preventDefault()},!0)}const n=["max-xs","max-sm","max-md","max-lg"];function o(t){return t.dataset.widthKey||"width_element"}function a(t,e){if(!t)return;const n=o(t);localStorage.setItem(n,e),t.classList.forEach(e=>{e.startsWith("max-")&&t.classList.remove(e)}),"auto"!==e?t.classList.add(e):t.style.maxWidth=""}function r(t,e,r=n){if(!t)return;const l=o(t),i=localStorage.getItem(l)||"auto";let s,c=r.indexOf(i);if(-1===c)s="prev"===e?r.length-1:0;else if("next"===e)s=(c+1)%r.length;else{if("prev"!==e)return;s=(c-1+r.length)%r.length}a(t,r[s])}function l(){const t=document.querySelector(".clock");if(t){const e=new Date;t.textContent=e.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1})}}function i({sectionId:t,toggleButtonId:e,logElementId:n,endpoint:o}){document.addEventListener("DOMContentLoaded",()=>{const a=document.body;if(!document.getElementById(t))return;const r=document.getElementById(e),l=document.getElementById(n);function i(t){const e=""===t.trim();l.innerHTML=e?'<code class="muted">No errors logged. You\'re doing great. üéâ</code>':`<code>${t}</code>`}function s(){fetch(`${window.BASE_URL}${o}`,{cache:"no-store"}).then(t=>t.ok?t.text():Promise.reject()).then(i)}r&&l&&(r.addEventListener("click",function(){const t=l.classList.contains("visible");l.classList.toggle("visible",!t),this.setAttribute("aria-expanded",!t)}),"true"===a.getAttribute("data-ajax-error-log-enabled")&&fetch(`${window.BASE_URL}${o}`,{cache:"no-store"}).then(t=>t.ok?t.text():Promise.reject()).then(t=>{i(t),setInterval(s,3e3)}).catch(()=>{}))})}function s(){const t=document.getElementById("export-group"),e=document.getElementById("export-folder"),n=document.getElementById("uploads-mode-row"),o=document.getElementById("export-files-form"),a=document.getElementById("export-files-status"),r=document.getElementById("export-db-form"),l=document.getElementById("export-db"),i=document.getElementById("export-db-status");if(!(t&&e&&o&&r))return;let s=[];function c(){return fetch(`${window.BASE_URL}utils/export_files.php?action=token`,{credentials:"same-origin"}).then(t=>t.json()).then(t=>{t.ok&&t.token&&document.querySelectorAll('input[name="csrf"]').forEach(e=>{e.value=t.token})}).catch(()=>{})}function d(){const t=document.querySelector('input[name="archiveEngine"]:checked');return t?t.value:"php"}c(),fetch(`${window.BASE_URL}utils/export_files.php?action=scan`,{credentials:"same-origin"}).then(t=>t.json()).then(o=>{if(!o.ok)throw new Error(o.error||"Failed to scan folders");if(s=o.groups||[],!s.length)return t.innerHTML='<option value="">No folders defined</option>',t.disabled=!0,e.innerHTML='<option value="">No subfolders</option>',e.disabled=!0,a&&(a.innerHTML="No folders defined. Add entries to <code>config/folders.json</code> to enable file exports."),void(n&&(n.style.display="none"));!function(t,e){t.innerHTML="",e.forEach(e=>{const n=document.createElement("option");n.value=String(e.index),n.textContent=e.title,t.appendChild(n)})}(t,s),t.options.length&&t.dispatchEvent(new Event("change"))}).catch(n=>{console.error(n),t.innerHTML='<option value="">Error loading groups</option>',t.disabled=!0,e.innerHTML='<option value="">‚Äî</option>',e.disabled=!0}),fetch(`${window.BASE_URL}utils/export_files.php?action=dbs`,{credentials:"same-origin"}).then(t=>t.json()).then(t=>{if(!t.ok)throw new Error(t.error||"Failed to list databases");var e,n;e=l,n=t.databases||[],e.innerHTML="",n.length?n.forEach(t=>{const n=document.createElement("option");n.value=t,n.textContent=t,e.appendChild(n)}):e.innerHTML='<option value="">No databases found</option>'}).catch(t=>{console.error(t),l.innerHTML='<option value="">Error loading databases</option>'}),t.addEventListener("change",()=>{const o=parseInt(t.value,10),a=Number.isNaN(o)?null:s[o];e.disabled=!0,e.innerHTML='<option value="">Select a group first‚Ä¶</option>',n&&(n.style.display="none");const r=document.querySelector('input[name="uploadsMode"][value="exclude"]');var l,i;(r&&(r.checked=!0),a)&&(l=e,i=a.subfolders,l.innerHTML="",i.length?i.forEach(t=>{const e=document.createElement("option");e.value=t.name,e.textContent=t.name,l.appendChild(e)}):l.innerHTML='<option value="">No subfolders found</option>',e.disabled=0===a.subfolders.length,a.subfolders.length>0&&(e.selectedIndex=0,e.dispatchEvent(new Event("change"))))}),e.addEventListener("change",()=>{const o=parseInt(t.value,10),a=Number.isNaN(o)?null:s[o];if(!a)return;const r=a.subfolders.find(t=>t.name===e.value),l=!!(r&&r.isWordPress&&r.hasUploads);n&&(n.style.display=l?"":"none");const i=document.querySelector('input[name="uploadsMode"][value="exclude"]');i&&(i.checked=!0)}),o.addEventListener("submit",t=>{t.preventDefault(),a.textContent="Preparing archive‚Ä¶";const e=new FormData(o);e.append("action","zip"),e.append("engine",d()),fetch(`${window.BASE_URL}utils/export_files.php`,{method:"POST",body:e,credentials:"same-origin"}).then(t=>t.json()).then(t=>{if(!t.ok)throw new Error(t.error||"Export failed");let e=`Done. <a href="${window.BASE_URL}${t.href}" download="${t.name}">${t.name}</a>`;return t.message&&(e+=`<br><small class="muted">${t.message}</small>`),a.innerHTML=e,window.location.href=`${window.BASE_URL}${t.href}`,c()}).catch(t=>(console.error(t),a.textContent="Error: "+t.message,c()))}),r.addEventListener("submit",t=>{t.preventDefault(),i.textContent="Dumping database‚Ä¶";const e=new FormData(r);e.append("action","dumpdb"),e.append("engine",d()),fetch(`${window.BASE_URL}utils/export_files.php`,{method:"POST",body:e,credentials:"same-origin"}).then(t=>t.json()).then(t=>{if(!t.ok)throw new Error(t.error||"DB export failed");let e=`Done. <a href="${window.BASE_URL}${t.href}" download="${t.name}">${t.name}</a>`;return t.message&&(e+=`<br><small class="muted">${t.message}</small>`),i.innerHTML=e,window.location.href=`${window.BASE_URL}${t.href}`,c()}).catch(t=>(console.error(t),i.textContent="Error: "+t.message,c()))})}function c(t,e={}){const n=e.placeholder||"HTML Template";let o="",a=!1,r=!1;function l(){return t.textContent.replace(/\u200B/g,"").replace(/\u00A0/g," ")}function i(t){const e=window.getSelection();if(!e.rangeCount)return null;const n=e.getRangeAt(0),o=n.cloneRange();o.selectNodeContents(t),o.setEnd(n.endContainer,n.endOffset);const a=t.textContent.length;return Math.min(o.toString().length,a)}function s(t,e){const n=window.getSelection(),o=document.createRange();let a=0,r=null;const l=document.createTreeWalker(t,NodeFilter.SHOW_TEXT,null,!1);for(;l.nextNode();){const t=l.currentNode,i=t.nodeValue.length;if(r=t,a+i>=e)return o.setStart(t,e-a),o.collapse(!0),n.removeAllRanges(),void n.addRange(o);a+=i}if(!r){const e=document.createTextNode("");t.appendChild(e),r=e}o.setStart(r,r.nodeValue.length),o.collapse(!0),n.removeAllRanges(),n.addRange(o)}function c(){a=!1;const r=l();if(r===o)return;const c=i(t);let d=r;d.endsWith("\n")&&!d.endsWith("\n‚Äã")&&(d+="‚Äã"),t.innerHTML=d.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/&lt;\/?[a-zA-Z][^&]*?&gt;/g,t=>{let e=t.slice(4,-4).trim(),n=!1,o=!1;e.startsWith("/")&&(n=!0,e=e.slice(1).trim()),e.endsWith("/")&&(o=!0,e=e.slice(0,-1).trim());const a=e.search(/\s/),r=(-1===a?e:e.slice(0,a)).toLowerCase();let l=-1===a?"":e.slice(a).trim();return l=l.replace(/([a-zA-Z_:][-a-zA-Z0-9_:.]*)\s*(=\s*(?:"[^"]*"|'[^']*'|[^\s'">=]+))?/g,(t,e,n)=>{if(!e)return t;if(!n)return`<span class="attr">${e}</span>`;const o=n.match(/^=\s*(?:"([^"]*)"|'([^']*)'|([^\s'">=]+))/);if(!o)return`<span class="attr">${e}</span>${n||""}`;const a=o[1]??o[2]??o[3]??"",r=o[1]?'"':o[2]?"'":"";return r?`<span class="attr">${e}</span>=<span class="value">${r}${a}${r}</span>`:`<span class="attr">${e}</span>=<span class="value">${a}</span>`}),`<span class="pun">&lt;${n?"/":""}</span><span class="tag">${r}</span>${l?` ${l}`:""}<span class="pun">${o?" /":""}&gt;</span>`}),t.hasAttribute("placeholder")||t.setAttribute("placeholder",n),r.length>0&&(!t.lastChild||t.lastChild.nodeType!==Node.TEXT_NODE)&&t.appendChild(document.createTextNode("")),null!=c&&s(t,c),o=r,e.onChange&&e.onChange(r)}function d(e){if("insertFromPaste"===e.inputType&&e.clipboardData){e.preventDefault();!function(e){const n=l(),a=i(t)??n.length,r=n.slice(0,a)+e+n.slice(a);t.textContent=r,s(t,a+e.length),o="",c()}(e.clipboardData.getData("text/plain").replace(/\r\n?/g,"\n"))}}function u(e){if("Escape"!==e.key)if("Tab"===e.key&&r)r=!1;else{if("Tab"===e.key){e.preventDefault();const n=l();let a=i(t),r=n;return e.shiftKey?"\t"===n.slice(a-1,a)?(r=n.slice(0,a-1)+n.slice(a),a-=1):"  "===n.slice(a-2,a)&&(r=n.slice(0,a-2)+n.slice(a),a-=2):(r=n.slice(0,a)+"\t"+n.slice(a),a+=1),t.textContent=r,s(t,a),o="",void c()}if("Enter"===e.key&&!e.shiftKey){const n=l();if(0===n.length)return;e.preventDefault();let a=i(t);const r="\n"+((n.slice(0,a).split(/\r?\n/).pop()||"").match(/^[\t ]+/)||[""])[0];let d=n.slice(0,a)+r+n.slice(a),u=a+r.length;d===n&&(d=n+r,u=n.length+r.length),t.textContent=d,t.focus(),s(t,u),o="",c()}}else r=!0}function p(n){return/^[\s\u200B]*$/.test(t.textContent)&&((n.inputType||"").startsWith("delete")||"deleteByCut"===n.inputType)?(t.innerHTML="",o="",void(e.onChange&&e.onChange(""))):"insertParagraph"===n.inputType||"insertFromPaste"===n.inputType||"insertFromDrop"===n.inputType||"historyUndo"===n.inputType||"historyRedo"===n.inputType?(o="",void c()):void(a||(a=!0,requestAnimationFrame(()=>{try{c()}finally{a=!1}})))}function m(){r=!1,c()}return t.setAttribute("contenteditable","true"),t.setAttribute("role","textbox"),t.setAttribute("aria-multiline","true"),t.setAttribute("aria-label",n),t.setAttribute("aria-describedby",e.describedBy||"editor-instructions"),t.setAttribute("placeholder",n),t.setAttribute("spellcheck","false"),t.setAttribute("autocomplete","off"),t.setAttribute("autocapitalize","off"),t.setAttribute("autocorrect","off"),t.addEventListener("beforeinput",d),t.addEventListener("keydown",u),t.addEventListener("input",p),t.addEventListener("blur",m),c(),{getValue:()=>l(),setValue(e){t.textContent=e||"",o="",c()},destroy(){t.removeEventListener("beforeinput",d),t.removeEventListener("keydown",u),t.removeEventListener("input",p),t.removeEventListener("blur",m)}}}function d(){const t=document.querySelector(".search-bar")?.value.toLowerCase()||"";document.querySelectorAll("#folders-view .columns li").forEach(e=>{const n=e.textContent.toLowerCase();e.style.display=n.includes(t)?"":"none"})}const u=["theme","columnOrder","accordion_","width_"];function p(t){const e=document.documentElement;e.className=e.className.split(/\s+/).filter(t=>t&&!t.endsWith("-theme")).join(" "),"default"!==t&&e.classList.add(`${t}-theme`);let n="dark";document.body.classList.contains("dark-mode")||(document.body.classList.remove("light-mode"),document.body.classList.add("dark-mode")),"undefined"!=typeof themeTypes&&"light"===themeTypes[t]&&(n="light",document.body.classList.contains("light-mode")||(document.body.classList.remove("dark-mode"),document.body.classList.add("light-mode")));let o=document.querySelector('meta[name="color-scheme" ]');o||(o=document.createElement("meta"),o.setAttribute("name","color-scheme"),document.head.appendChild(o)),o.getAttribute("content")!==n&&o.setAttribute("content",n)}function m(){document.querySelectorAll("[data-generate-cert]").forEach(t=>{t.addEventListener("click",()=>{const e=t.dataset.generateCert;confirm("Generate a new SSL certificate for "+e+"?")&&fetch(`${window.BASE_URL}utils/generate_cert.php?name=${encodeURIComponent(e)}`).then(t=>t.text()).then(t=>{if(alert(t),t.includes("successfully")){const t=document.getElementById("restart-apache");t&&t.click()}}).catch(()=>alert("Failed to run cert script."))})})}function h(){const t=document.getElementById("vhost-filter"),e=document.querySelectorAll("#vhosts-table tbody tr");t&&e.length&&t.addEventListener("change",()=>{const n=t.value;let o=0;e.forEach(t=>{const e=t.classList.contains("vhost-ssl"),a=t.classList.contains("cert-valid"),r=t.classList.contains("host-valid");let l=!0;"missing-cert"===n?l=!a:"missing-host"===n?l=!r:"ssl-only"===n?l=e:"non-ssl"===n&&(l=!e),t.style.display=l?"":"none",l&&o++});const a=document.getElementById("vhost-empty-msg");a&&(a.style.display=0===o?"":"none")})}function f(){document.addEventListener("click",t=>{if(t.target.matches(".open-folder")){const e=t.target.dataset.path.replace(/^"(.*)"$/,"$1");e&&fetch(`${window.BASE_URL}utils/open_folder.php`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:e})})}})}!function(){function t(){const t=document.querySelectorAll(".collapse-toggle");t.length&&t.forEach(t=>{t.setAttribute("data-state","expanded"),t.setAttribute("aria-expanded","true"),t.addEventListener("click",e=>{e.preventDefault();const n=function(t){const e=t.getAttribute("data-target-selector"),n=t.getAttribute("data-collapse-region")||"custom";return e?document.querySelector(e):"header"===n?document.querySelector('header[role="banner"]')||document.querySelector("header"):"footer"===n?document.querySelector("footer"):null}(t),o="collapsed"===t.getAttribute("data-state");!function(t,e,n){const o=t.getAttribute("data-collapse-region")||"custom",a=t.getAttribute("data-label-expanded")||"Collapse section",r=t.getAttribute("data-label-collapsed")||"Expand section",l=t.querySelector(".collapse-toggle-label");t.setAttribute("data-state",n?"collapsed":"expanded"),t.setAttribute("aria-expanded",n?"false":"true"),t.setAttribute("aria-label",n?r:a),l&&(l.textContent=n?r:a),e&&(n?(e.classList.add("is-collapsed"),e.classList.remove("is-open")):(e.classList.remove("is-collapsed"),e.classList.add("is-open"))),("header"===o||"footer"===o)&&document.body.classList.toggle(`${o}-collapsed`,n)}(t,n,!o)})})}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",t):t()}(),document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll(".width-resizable").forEach(t=>{const e=o(t),r=localStorage.getItem(e);r&&n.includes(r)&&a(t,r)}),document.querySelectorAll(".width-controls").forEach(t=>{const e=t.dataset.widthFor;if(!e)return;const o=document.querySelector(`.width-resizable[data-width-key="${e}"]`);if(!o)return;const l=t.querySelector('[data-action="reset"]'),i=t.querySelector('[data-action="decrease"]'),s=t.querySelector('[data-action="increase"]');l&&l.addEventListener("click",()=>{a(o,"auto")}),i&&i.addEventListener("click",()=>{r(o,"prev",n)}),s&&s.addEventListener("click",()=>{r(o,"next",n)})});const t=document.querySelector(".columns");if(t){const l=JSON.parse(localStorage.getItem("columnOrder")||"[]");function i(){const e=Array.from(t.querySelectorAll(":scope > .column:not(.column-controls)")).map(t=>t.id).filter(Boolean);localStorage.setItem("columnOrder",JSON.stringify(e))}Array.isArray(l)&&l.length&&l.forEach(e=>{const n=document.getElementById(e);n&&n.classList.contains("column")&&!n.classList.contains("column-controls")&&t.appendChild(n)}),e(".columns",{items:".column:not(.column-controls)",handle:".drag-handle"}),t.addEventListener("sorted",i)}}),document.addEventListener("DOMContentLoaded",()=>{l(),setInterval(l,1e3)}),document.addEventListener("DOMContentLoaded",()=>{const t=document.getElementById("dock-list"),n=document.getElementById("add-dock-item"),o=document.querySelector("#settings-view form");function a(e={}){const n=document.createElement("li");n.className="dock-item",n.innerHTML=`\n\t\t\t\t<input type="text" placeholder="Label" value="${e.label||""}">\n\t\t\t\t<input type="text" placeholder="URL" value="${e.url||""}">\n\t\t\t\t<input type="text" placeholder="Icon" value="${e.icon||""}">\n\t\t\t\t<input type="text" placeholder="Alt Text" value="${e.alt||""}">\n\t\t\t\t<button type="button" class="remove-dock-item">‚ùå</button>\n\t\t\t`,t.appendChild(n),n.querySelector(".remove-dock-item").addEventListener("click",()=>{n.remove(),r()}),Array.from(n.querySelectorAll("input")).forEach(t=>{t.addEventListener("input",r)})}function r(){const e=[];Array.from(t.children).forEach(t=>{const n=t.querySelectorAll("input");n.length<4||e.push({label:n[0].value.trim(),url:n[1].value.trim(),icon:n[2].value.trim(),alt:n[3].value.trim()})});const n=document.getElementById("dock_json_input");n&&(n.value=JSON.stringify(e,null,2))}t&&n&&o&&(fetch(`${window.BASE_URL}utils/read_config.php?file=dock`,{cache:"no-store"}).then(t=>t.json()).then(n=>{n.forEach(a),e("#dock-list"),t.addEventListener("sorted",r),r()}),n.addEventListener("click",()=>{a(),e("#dock-list"),r()}))}),document.addEventListener("DOMContentLoaded",()=>{const t=document.getElementById("folders-config-list"),n=document.getElementById("add-folder-column"),o=document.getElementById("folders_json_input");if(!t||!n||!o)return;let a=[],r='<option value="">(none)</option>',l=!1,i=null;function s(t={}){return`\n\t\t\t\t<div class="special-case">\n\t\t\t\t\t<input type="text"\n\t\t\t\t\t       class="sc-match"\n\t\t\t\t\t       placeholder="Match Regex"\n\t\t\t\t\t       aria-label="Special case match regex"\n\t\t\t\t\t       value="${t.match||""}">\n\n\t\t\t\t\t<input type="text"\n\t\t\t\t\t       class="sc-replace"\n\t\t\t\t\t       placeholder="Replace Regex"\n\t\t\t\t\t       aria-label="Special case replace regex"\n\t\t\t\t\t       value="${t.replace||""}">\n\n\t\t\t\t\t<button type="button"\n\t\t\t\t\t        class="remove-special"\n\t\t\t\t\t        aria-label="Remove this special case">\n\t\t\t\t\t\t‚úñ\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t`}function c(t={}){const e=(n=t.specialCases,n&&"object"==typeof n&&!Array.isArray(n)?Object.entries(n).map(([t,e])=>({match:String(t??""),replace:String(e??"")})):[]).map(s).join("");var n;t.linkTemplate;const o=`${Math.random().toString(36).slice(2)}`,a=`folder-label-${o}`;return`\n\t\t\t\t<li class="folder-config-item" role="group" aria-labelledby="${a}">\n\t\t\t\t\t<h4 id="${a}" class="folder-label">\n\t\t\t\t\t\t${"number"==typeof index?`Folder ${index}`:"Folder"}\n\t\t\t\t\t</h4>\n\t\t\t\t\t<div class="uid-container">\n\t\t\t\t\t\t<label for="title-${o}">Title:</label>\n\t\t\t\t\t\t<input id="title-${o}"\n\t\t\t\t\t\t\t   type="text"\n\t\t\t\t\t\t\t   data-key="title"\n\t\t\t\t\t\t\t   placeholder="Title"\n\t\t\t\t\t\t\t   value="${t.title||""}">\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="uid-container">\n\t\t\t\t\t\t<label for="href-${o}">Href (optional):</label>\n\t\t\t\t\t\t<input id="href-${o}"\n\t\t\t\t\t\t\t   type="text"\n\t\t\t\t\t\t\t   data-key="href"\n\t\t\t\t\t\t\t   placeholder="Href (optional)"\n\t\t\t\t\t\t\t   value="${t.href||""}">\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="uid-container">\n\t\t\t\t\t\t<label for="dir-${o}">Dir (relative to HTDOCS_PATH):</label>\n\t\t\t\t\t\t<input id="dir-${o}"\n\t\t\t\t\t\t\t   type="text"\n\t\t\t\t\t\t\t   data-key="dir"\n\t\t\t\t\t\t\t   placeholder="Dir (relative to HTDOCS_PATH)"\n\t\t\t\t\t\t\t   value="${t.dir||""}">\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="uid-container">\n\t\t\t\t\t\t<label for="excludeList-${o}">Exclude list (comma-separated):</label>\n\t\t\t\t\t\t<input id="excludeList-${o}"\n\t\t\t\t\t\t\t   type="text"\n\t\t\t\t\t\t\t   data-key="excludeList"\n\t\t\t\t\t\t\t   placeholder="Exclude list (comma-separated)"\n\t\t\t\t\t\t\t   value="${(t.excludeList||[]).join(",")}">\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="uid-container grouped-labels">\n\t\t\t\t\t\t<label for="match-${o}">Match Regex:</label>\n\t\t\t\t\t\t<input id="match-${o}"\n\t\t\t\t\t\t\t   type="text"\n\t\t\t\t\t\t\t   data-key="match"\n\t\t\t\t\t\t\t   placeholder="Match Regex"\n\t\t\t\t\t\t\t   value="${t.urlRules?.match??""}">\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="uid-container grouped-labels">\n\t\t\t\t\t\t<label for="replace-${o}">Replace Regex:</label>\n\t\t\t\t\t\t<input id="replace-${o}"\n\t\t\t\t\t\t\t   type="text"\n\t\t\t\t\t\t\t   data-key="replace"\n\t\t\t\t\t\t\t   placeholder="Replace Regex"\n\t\t\t\t\t\t\t   value="${t.urlRules?.replace??""}">\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="uid-container grouped-labels">\n\t\t\t\t\t\t<label for="linkTemplate-${o}">Link Template:</label>\n\t\t\t\t\t\t<select id="linkTemplate-${o}"\n\t\t\t\t\t\t\t    class="link-template-select"\n\t\t\t\t\t\t\t    name="linkTemplate">\n\t\t\t\t\t\t\t${r}\n\t\t\t\t\t\t</select>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="uid-container grouped-container grouped-labels" role="group" aria-labelledby="folder-behaviour-${o}">\n\t\t\t\t\t\t<label id="folder-behaviour-${o}">Folder Behaviour:</label>\n\n\t\t\t\t\t\t<label for="disable-links-${o}">\n\t\t\t\t\t\t\t<input id="disable-links-${o}"\n\t\t\t\t\t\t\t       type="checkbox"\n\t\t\t\t\t\t\t       class="disable-links"${t.disableLinks?" checked":""}>\n\t\t\t\t\t\t\tDisable links\n\t\t\t\t\t\t</label>\n\n\t\t\t\t\t\t<label for="require-vhost-${o}">\n\t\t\t\t\t\t\t<input id="require-vhost-${o}"\n\t\t\t\t\t\t\t       type="checkbox"\n\t\t\t\t\t\t\t       class="require-vhost"${t.requireVhost?" checked":""}>\n\t\t\t\t\t\t\tValid vHost only\n\t\t\t\t\t\t</label>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="uid-container special-cases-wrapper" aria-labelledby="special-cases-${o}">\n\t\t\t\t\t\t<span id="special-cases-${o}">Special Cases:</span>\n\t\t\t\t\t\t<div class="special-cases">${e}</div>\n\t\t\t\t\t\t<button type="button" class="add-special" aria-label="Add special case rule">‚ûï Add Rule</button>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<button type="button" class="remove-folder-column" aria-label="Remove this folder column">‚ùå</button>\n\t\t\t\t</li>\n\t\t\t`}function d(){t.querySelectorAll(".folder-config-item").forEach((t,e)=>{const n=t.querySelector(".folder-label");n&&(n.textContent=`Folder ${e+1}`)})}function u(e={}){const n=document.createElement("div");t.querySelectorAll(".folder-config-item").length,n.innerHTML=c(e);const o=n.firstElementChild;t.appendChild(o);const r=o.querySelector(".link-template-select");r&&(r.disabled=0===a.length,e.linkTemplate&&(r.value=e.linkTemplate)),d(),p()}function p(){l=!0,i&&clearTimeout(i),i=setTimeout(m,120)}function m(){i=null,l&&(o.value=JSON.stringify(function(){const e=[];return t.querySelectorAll(".folder-config-item").forEach(t=>{const n=e=>t.querySelector(e),o=n('input[data-key="title"]')?.value.trim()||"",a=n('input[data-key="href"]')?.value.trim()||"",r=n('input[data-key="dir"]')?.value.trim()||"",l=n('input[data-key="excludeList"]')?.value||"",i=n('input[data-key="match"]')?.value||"",s=n('input[data-key="replace"]')?.value||"",c=t.querySelector(".link-template-select")?.value||"",d=!!t.querySelector(".disable-links")?.checked,u=!!t.querySelector(".require-vhost")?.checked,p=[];t.querySelectorAll(".special-case").forEach(t=>{const e=t.querySelector(".sc-match")?.value||"",n=t.querySelector(".sc-replace")?.value||"";(e.length||n.length)&&p.push({match:e,replace:n})});const m=function(t){const e={};return t.forEach(({match:t="",replace:n=""})=>{const o=String(t).trim(),a=String(n).trim();(o.length||a.length)&&(e[o]=a)}),e}(p),h=l.split(",").map(t=>t.trim()).filter(Boolean),f={title:o,href:a,dir:r,excludeList:h,urlRules:{match:i,replace:s},linkTemplate:c,disableLinks:d,requireVhost:u,specialCases:m};(o||a||r||h.length||i||s||c||d||u||Object.keys(m).length)&&e.push(f)}),e}(),null,2),l=!1)}t.addEventListener("input",t=>{t.target.matches('input[type="text"], select')&&p()}),t.addEventListener("change",t=>{t.target.matches('select, input[type="checkbox"]')&&p()}),t.addEventListener("click",t=>{if(t.target.closest(".add-special")){const e=t.target.closest(".folder-config-item")?.querySelector(".special-cases");e&&(e.insertAdjacentHTML("beforeend",s()),p())}if(t.target.closest(".remove-special")){const e=t.target.closest(".special-case");e&&(e.remove(),p())}if(t.target.closest(".remove-folder-column")){const e=t.target.closest(".folder-config-item");e&&(e.remove(),d(),p())}}),t.addEventListener("sorted",()=>{d(),l=!0,m()}),Promise.all([fetch(`${window.BASE_URL}utils/read_config.php?file=folders`,{cache:"no-store"}).then(t=>t.json()).catch(()=>[]),Array.isArray(window.LINK_TEMPLATES)?(a=window.LINK_TEMPLATES.map(t=>t&&"string"==typeof t.name?t.name.trim():"").filter(Boolean),a=Array.from(new Set(a)),r='<option value="">(none)</option>'+a.map(t=>`<option value="${t}">${t}</option>`).join(""),Promise.resolve(a)):fetch(`${window.BASE_URL}utils/read_config.php?file=link_templates`,{cache:"no-store"}).then(t=>t.json()).then(t=>(a=(Array.isArray(t)?t:[]).map(t=>t&&"string"==typeof t.name?t.name.trim():"").filter(Boolean),a=Array.from(new Set(a)),r='<option value="">(none)</option>'+a.map(t=>`<option value="${t}">${t}</option>`).join(""),a)).catch(()=>(a=[],r='<option value="">(none)</option>',a))]).then(([n])=>{e("#folders-config-list"),Array.isArray(n)&&n.length&&function(e){const n=document.createDocumentFragment(),o=document.createElement("div");t.querySelectorAll(".folder-config-item").length,o.innerHTML=e.map((t,e)=>c(t)).join(""),Array.from(o.children).forEach(t=>n.appendChild(t)),t.appendChild(n),t.querySelectorAll(".folder-config-item").forEach(t=>{const n=t.querySelector(".link-template-select");if(n){const o=t.querySelector('input[data-key="title"]')?.value||"",r=e.find(t=>(t.title||"")===o),l=r?.linkTemplate||"";l&&(n.value=l),n.disabled=0===a.length}}),d()}(n),0===t.children.length&&u({}),l=!0,m()}),n.addEventListener("click",()=>{u({})})}),document.addEventListener("DOMContentLoaded",()=>{const t=document.getElementById("link-templates-list"),e=document.getElementById("add-link-template"),n="HTML Template";function o(){const e=[];t.querySelectorAll(".template-item").forEach(t=>{const n=t.querySelector(".template-name")?.value.trim();let o="";o=t.querySelector(".template-html")?.textContent||"",o=o.replace(/\u200B/g,""),n&&o&&e.push({name:n,html:o})});const n=document.getElementById("link_templates_json_input");n&&(n.value=JSON.stringify(e,null,2))}function a(e={}){const a=document.createElement("li");a.className="template-item";let r="";r=`\n\t\t\t\t\t<div class="template-html-wrapper">\n\t\t\t\t\t\t<pre class="template-html syntax-highlight"\n\t\t\t\t\t\t\trole="textbox" aria-multiline="true" aria-label="HTML Template"\n\t\t\t\t\t\t\tplaceholder="${n}"></pre>\n\t\t\t\t\t</div>`,a.innerHTML=`\n\t\t\t\t<input type="text" class="template-name" placeholder="Template Name" value="${e.name||""}">\n\t\t\t\t${r}\n\t\t\t\t<button type="button" class="remove-template">‚ùå</button>\n\t\t\t`;let l=null;{const t=a.querySelector(".template-html");t.textContent=e.html||"",l=c(t,{placeholder:n,onChange:o})}a.querySelector(".remove-template").addEventListener("click",()=>{l&&"function"==typeof l.destroy&&l.destroy(),a.remove(),o()}),a.querySelector(".template-name").addEventListener("input",o),t.appendChild(a),o()}t&&e&&(e.addEventListener("click",()=>a()),t.innerHTML="",fetch(`${window.BASE_URL}utils/read_config.php?file=link_templates`,{cache:"no-store"}).then(t=>t.json()).then(t=>{(Array.isArray(t)?t:Array.isArray(t?.templates)?t.templates:[]).forEach(a),o()}).catch(()=>o()))}),i({sectionId:"apache-error-log-section",toggleButtonId:"toggle-apache-error-log",logElementId:"apache-error-log",endpoint:"utils/apache_error_log.php"}),i({sectionId:"php-error-log-section",toggleButtonId:"toggle-php-error-log",logElementId:"php-error-log",endpoint:"utils/php_error_log.php"}),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>s()):s(),document.addEventListener("DOMContentLoaded",()=>{const t=document.querySelector(".search-bar");t&&t.addEventListener("input",d)}),document.addEventListener("DOMContentLoaded",()=>{const t=document.getElementById("clear-local-storage");t&&t.addEventListener("click",()=>{confirm("Are you sure you want to reset saved UI settings?")&&(Object.keys(localStorage).filter(t=>u.some(e=>t.startsWith(e))).forEach(t=>localStorage.removeItem(t)),alert("Saved settings have been cleared from local storage."),location.reload())})}),document.addEventListener("DOMContentLoaded",()=>{const t=document.querySelector(".post-confirmation-container");t&&setTimeout(()=>{t.style.transition="opacity 0.5s ease",t.style.opacity="0",setTimeout(()=>t.remove(),500)},3e3)}),document.addEventListener("DOMContentLoaded",()=>{const t=document.body;if(!document.getElementById("system-monitor"))return;if("true"!==t.getAttribute("data-ajax-stats-enabled"))return;const e=document.getElementById("cpu-load"),n=document.getElementById("memory-usage"),o=document.getElementById("disk-space");let a;function r(){fetch(`${window.BASE_URL}utils/system_stats.php`,{cache:"no-store"}).then(t=>{if(!t.ok)throw new Error("System stats unavailable");return t.json()}).then(t=>{e.textContent=`${t.cpu}%`,n.textContent=`${t.memory} MB`,o.textContent=`${t.disk}%`})}fetch(`${window.BASE_URL}utils/system_stats.php`,{cache:"no-store"}).then(t=>{if(t.ok)return t.json()}).then(t=>{e.textContent=`${t.cpu}%`,n.textContent=`${t.memory} MB`,o.textContent=`${t.disk}%`,a=setInterval(r,1e3),r()}).catch(()=>{})}),document.addEventListener("DOMContentLoaded",()=>{const t=document.querySelector("#theme-selector");if(!t)return;const e=localStorage.getItem("theme")||("undefined"!=typeof serverTheme?serverTheme:"default");p(e),t.value=e,t.addEventListener("change",t=>{const e=t.target.value;p(e),localStorage.setItem("theme",e)})}),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{m(),h(),f()}):(m(),h(),f()),function(){function t(t){t.offsetHeight}function e(t){const e=getComputedStyle(t),n=t=>t.split(",").map(t=>parseFloat(t)||0),o=Math.max(...n(e.transitionDuration)),a=Math.max(...n(e.transitionDelay));return Math.round(1e3*(o+a))||0}document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll(".toggle-content-container").forEach((n,o)=>{if("1"===n.dataset.accordionInit)return;n.dataset.accordionInit="1";const a=n.querySelector(".toggle-accordion"),r=n.querySelector(".toggle-content");if(!a||!r)return;const l=parseInt(r.dataset.collapsedHeight)||0,i=n.dataset.id||"accordion-"+o;let s=0,c=0,d=null;function u(){d&&(r.removeEventListener("transitionend",d),d=null),c&&(clearTimeout(c),c=0)}function p(t){n.classList.toggle("open",t),a.setAttribute("aria-expanded",t?"true":"false"),localStorage.setItem("accordion_"+i,t?"open":"closed")}function m(t){t===s&&(r.style.height="auto")}function h(t){t===s&&(r.hidden=!0)}function f(){const o=!n.classList.contains("open");o&&r.hidden&&(r.hidden=!1),o?function(){const n=++s;u(),r.hidden=!1,p(!0),r.style.height=l+"px",t(r),requestAnimationFrame(()=>{if(n!==s)return;const t=r.scrollHeight;r.style.height=t+"px",d=t=>{t.target===r&&"height"===t.propertyName&&(u(),m(n))},r.addEventListener("transitionend",d);const o=e(r);o>0&&(c=setTimeout(()=>{u(),m(n)},o+40))})}():function(){const n=++s;u(),p(!1),r.style.height=r.scrollHeight+"px",t(r),requestAnimationFrame(()=>{if(n!==s)return;r.style.height=l+"px",d=t=>{t.target===r&&"height"===t.propertyName&&(u(),h(n))},r.addEventListener("transitionend",d);const t=e(r);t>0&&(c=setTimeout(()=>{u(),h(n)},t+40))})}(),requestAnimationFrame(()=>{n.classList.contains("open")&&r.hidden&&(r.hidden=!1)})}const g="open"===localStorage.getItem("accordion_"+i);p(g),g?(r.hidden=!1,r.style.height=r.scrollHeight+"px",requestAnimationFrame(()=>{r.style.height="auto"})):(r.style.height=l+"px",r.hidden=!0),a.addEventListener("click",t=>{var e;(t.stopPropagation(),e=".tooltip-icon",t.target.closest(e))||f()}),a.addEventListener("keydown",t=>{if(" "===t.key||"Enter"===t.key)t.preventDefault(),f();else if("ArrowDown"===t.key&&n.classList.contains("open")&&!r.hidden){const t=r.querySelector('a,button,input,select,textarea,[tabindex]:not([tabindex="-1"])');t&&t.focus()}})}),window.addEventListener("resize",()=>{document.querySelectorAll(".toggle-content-container.open .toggle-content").forEach(t=>{t.hidden&&(t.hidden=!1),"auto"!==t.style.height&&(t.style.height=t.scrollHeight+"px")})})})}(),document.addEventListener("DOMContentLoaded",()=>{const t={index:document.getElementById("folders-view"),settings:document.getElementById("settings-view"),phpinfo:document.getElementById("phpinfo-view"),apache:document.getElementById("apache-view"),mysql:document.getElementById("mysql-view")},e={index:"index",settings:"settings",phpinfo:"phpinfo","apache-inspector":"apache","mysql-inspector":"mysql"},n={"toggle-index":"index","toggle-settings":"settings","toggle-phpinfo":"phpinfo","toggle-apache-inspector":"apache-inspector","toggle-mysql-inspector":"mysql-inspector"};function o(){return new URLSearchParams(window.location.search).get("view")||"index"}function a(o,a=!1){const r=e[o]||"index";if(function(t){Object.entries(n).forEach(([e,n])=>{const o=document.getElementById(e);o&&(n===t?(o.classList.add("active-page"),o.setAttribute("aria-current","page")):(o.classList.remove("active-page"),o.removeAttribute("aria-current")))})}(o),Object.entries(t).forEach(([t,e])=>{e&&e.classList.toggle("visible",t===r)}),function(t){const e=document.getElementById("page-title-prefix");if(!e)return;const n=e.dataset.prefix||"",o={index:"Modern Localhost and Remote Dashboard for Apache, MySQL & PHP",settings:"Settings",phpinfo:"PHP Info","apache-inspector":"Apache Inspector","mysql-inspector":"MySQL Inspector"},a=o[t]||o.index;document.title=n+a}(o),"apache"===r||"mysql"===r){const e=t[r];if(e&&!e.dataset.loaded){e.innerHTML='<div class="loader"><span class="spinner" role="img" aria-label="Loading"></span></div>';const t=`utils/${r}_inspector.php`;fetch(`${window.BASE_URL||"/"}${t}`).then(t=>t.text()).then(t=>{e.innerHTML=t,e.dataset.loaded="true"}).catch(n=>{e.innerHTML=`<p class="error">Failed to load ${t}</p>`,console.error(`[view.js] Failed to fetch ${t}`,n)})}}if(a){const t=window.BASE_URL||window.location.pathname,e="index"===r?"":"?view="+encodeURIComponent(o);history.pushState({},"",t+e)}}Object.entries(n).forEach(([t,e])=>{const n=document.getElementById(t);n&&n.addEventListener("click",t=>{t.preventDefault(),a(e,!0)})}),a(o()),window.addEventListener("popstate",()=>{a(o())})})})();
//# sourceMappingURL=script.min.js.map